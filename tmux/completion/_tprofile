#compdef tprofile

_directory_readable() {
    unset ROOT
    source "${1}"
    [[ -z "${ROOT}" || -r "${ROOT}" ]]
}

LIST=()

prefix="${DOTFILES_ROOT}/tmux/profiles/"
suffix=".sh"

for file in "${prefix}"*"${suffix}"; do
    if _directory_readable "${file}"; then
        LIST=("${${file#${prefix}}//${suffix}}" "${LIST}")
    fi
done

_arguments \
    "1:profiles:(${LIST})" \
    "2:options:(--no-vagrant)"
