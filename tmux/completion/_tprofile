#compdef tprofile

_directory_writable() {
    unset ROOT
    source "${1}"
    [[ -z "${ROOT}" || -w "${ROOT}" ]]
}

LIST=()

prefix="${DOTFILES_ROOT}/tmux/profiles/"
suffix=".sh"

for file in "${prefix}"*"${suffix}"; do
    if _directory_writable "${file}"; then
        LIST=("${${file#${prefix}}//${suffix}}" "${LIST}")
    fi
done

_arguments \
    "1:profiles:(${LIST})" \
    "*:options:(--only-fetch --no-lorri-update)"

# vim: ft=sh
