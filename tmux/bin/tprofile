#!/bin/bash

source "${HOME}/.dotfiles-variables"

CONF="${DOTFILES_ROOT}/tmux/profiles/${1}.sh"

if ! hash tmux > /dev/null 2>&1; then
    echo "tmux not installed"
    exit 1
fi

if [ ! -r "${CONF}" ]; then
    echo "${CONF} does not exists"
    exit 1
fi

. "${CONF}"

ROOT="${ROOT:-${HOME}}"

if [ ! -d "${ROOT}" ]; then
    echo "directory does not exists"
    exit 1
fi

for cmd_index in "${!PANE_CMDS[@]}"; do
    [[ $cmd_index != 0 ]] && tmux split-window
    tmux send-keys -t :.$(($cmd_index + 1)) "cd ${ROOT} && clear" C-m
    [[ ! -z "${PANE_CMDS[$cmd_index]}" ]] && tmux send-keys -t :.$(($cmd_index + 1)) "${PANE_CMDS[$cmd_index]}" C-m
done

[ ! -z "${LAYOUT}" ] && tmux select-layout "${LAYOUT}"
tmux select-pane -t :.1
tmux rename-window "${TITLE}"

exit 0
