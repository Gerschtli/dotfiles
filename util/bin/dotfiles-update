#!/usr/bin/env bash
set -e

source "$(dirname "$0")/../util/dotfiles-variables.symlink"
source "${DOTFILES_ROOT}/util/script-functions"

pushd "${DOTFILES_ROOT}" 1> /dev/null

if [[ -z "${1}" ]]; then
    _d_info "========= DOTFILES ========="
    _d_pull

    if [[ -d "gpg" ]]; then
        pushd "gpg" 1> /dev/null
        echo
        _d_info "============ GPG ==========="
        _d_pull
        popd 1> /dev/null
    fi

    if [[ -d "ssh" ]]; then
        pushd "ssh" 1> /dev/null
        echo
        _d_info "============ SSH ==========="
        _d_pull
        popd 1> /dev/null
    fi

    echo
    _d_info "===== SUBMOUDLE UPDATE ====="
    _d_indent git submodule update --init
    _d_indent git submodule foreach git checkout master
    _d_indent git submodule foreach git pull
fi

if available termux-fix-shebang; then
    echo
    _d_info "==== TERMUX FIX SHEBANG ===="
    _d_indent termux-fix-shebang bootstrap.sh */bin/* git/git-templates.symlink/hooks/{pre-,post-,scripts/}*
fi

echo
_d_info "========= BOOTSTRAP ========"
_d_indent ./bootstrap.sh

popd 1> /dev/null

exit 0
