#!/usr/bin/env bash

FILE="$(mktemp --suffix=-lorri-one-shot)"

lorri watch > "${FILE}" 2>&1 &
PID=$!

tail -f "${FILE}" | while read line; do
    if [[ "${line}" == "Completed(" ]]; then
        kill $PID
        exit 0
    elif [[ "${line}" == "Failure(" ]]; then
        cat "${FILE}"
        kill $PID
        exit 1
    fi
done
