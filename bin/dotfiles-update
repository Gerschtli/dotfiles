#!/bin/bash

print() {
    printf "[\033[00;34mINFO\033[0m] ${1}\n"
}

set -e

pushd "$(dirname "$0")/.." 1> /dev/null

if [[ -z "${1}" ]]; then
    print "git fetch --prune ..."
    git fetch --prune

    print "git checkout master ..."
    git checkout master

    if [[ $(git status --porcelain) != "" ]]; then
        STASH=true
        print "git stash ..."
        git stash
    fi

    print "git rebase -n origin/master ..."
    git rebase -n origin/master

    if [[ ! -z "${STASH}" ]]; then
        print "git stash pop ..."
        git stash pop
    fi
fi

print "./bootstrap.sh ..."
./bootstrap.sh

popd 1> /dev/null

exit 0
