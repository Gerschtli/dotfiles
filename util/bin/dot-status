#!/usr/bin/env bash

source "${HOME}/.dotfiles-variables"
source "${DOTFILES_ROOT}/util/script-functions"

git_status() {
    local title="${1}"
    local directory="${2}"
    local submodule="${3:-0}"

    if [[ ! -d "${directory}" ]]; then
        return
    fi

    _d_info "${title}"
    if [[ "${submodule}" == 1 ]]; then
        git -C "${directory}" submodule foreach git status
    else
        git -C "${directory}" status
        echo -n $'\n\n'
    fi
}

git_status "========= DOTFILES =========" "${DOTFILES_ROOT}"
git_status "=========== GPG ============" "${DOTFILES_ROOT}/gpg"

for ssh_module in "${DOTFILES_ROOT}/ssh/modules/"*; do
    git_status "======== SSH $(basename "${ssh_module}") ========" "${ssh_module}"
done

git_status "======== SUBMODULES ========" "${DOTFILES_ROOT}" 1
